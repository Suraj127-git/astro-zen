---
import type { HeroProps } from "@types";
type Props = HeroProps;

const { name, specialty, summary, email, tagline, stats, availability } = Astro.props;
---

<section class="min-h-screen pt-0 pb-20 md:pb-32 relative overflow-hidden flex items-center" id="#hero">
  <!-- Animated background elements -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <div class="hero-bg-gradient absolute top-20 -right-40 w-96 h-96 bg-primary/10 rounded-full blur-3xl"></div>
    <div class="hero-bg-gradient-2 absolute bottom-20 -left-40 w-80 h-80 bg-blue-500/10 rounded-full blur-3xl"></div>
    <div class="absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-black/5"></div>
  </div>

  <!-- Content -->
  <div class="relative z-10 w-full">
    <div class="max-w-5xl">
      <!-- Availability Badge -->
      {availability && (
        <div class="inline-flex items-center gap-2 px-4 py-2 mb-8 rounded-full border border-primary/30 bg-primary/5 hero-availability backdrop-blur-sm">
          <span class={`w-2 h-2 rounded-full ${availability.status === 'available' ? 'bg-green-500 animate-pulse' : 'bg-yellow-500'}`}></span>
          <span class="text-sm font-medium text-neutral">{availability.text}</span>
        </div>
      )}

      <!-- Main Headline - Value Proposition -->
      {tagline && (
        <h2 class="text-xl sm:text-2xl md:text-3xl font-medium text-primary mb-6 hero-tagline tracking-tight">
          {tagline}
        </h2>
      )}

      <!-- Name -->
      <h1 class="text-5xl sm:text-6xl md:text-7xl lg:text-8xl font-serif mb-4 text-white font-bold tracking-tightest hero-name leading-tight">
        <span class="inline-block">
          {name.split(' ').map((word, i) => (
            <span class="inline-block mr-4 hero-name-word" data-word-index={i}>
              {word.split('').map((char, j) => (
                <span class="inline-block hero-name-char" data-char-index={j}>
                  {char === ' ' ? '\u00A0' : char}
                </span>
              ))}
            </span>
          ))}
        </span>
      </h1>

      <!-- Specialty/Role -->
      <p class="text-3xl sm:text-4xl md:text-5xl font-serif text-white/90 font-semibold tracking-tight mb-8 hero-specialty">
        {specialty}
      </p>

      <!-- Summary/Description -->
      <p class="text-lg md:text-xl text-neutral/90 font-normal mb-10 max-w-3xl hero-summary leading-relaxed">
        {summary}
      </p>

      <!-- Stats Section -->
      {stats && stats.length > 0 && (
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-12 hero-stats">
          {stats.map((stat, index) => (
            <div class="hero-stat-item" data-stat-index={index}>
              <div class="text-3xl md:text-4xl font-bold text-primary mb-1 font-serif">
                {stat.value}
              </div>
              <div class="text-sm md:text-base text-neutral/70 font-medium">
                {stat.label}
              </div>
            </div>
          ))}
        </div>
      )}

      <!-- CTA Buttons -->
      <div class="flex gap-4 flex-wrap items-center">
        <a
          class="group text-sm md:text-base py-4 px-8 md:py-5 md:px-10 text-white inline-flex items-center gap-3 font-semibold leading-5 bg-gradient-to-r from-primary to-blue-500 rounded-full hero-cta relative overflow-hidden shadow-lg shadow-primary/30 hover:shadow-xl hover:shadow-primary/40 transition-all duration-300"
          href={`mailto:${email}`}
        >
          <span class="relative z-10">Let's Work Together</span>
          <svg class="w-5 h-5 relative z-10 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
          </svg>
          <div class="absolute inset-0 bg-gradient-to-r from-blue-500 to-primary opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
        </a>

        <a
          href="#projects"
          class="group text-sm md:text-base py-4 px-8 md:py-5 md:px-10 text-white inline-flex items-center gap-3 font-semibold leading-5 border-2 border-white/20 rounded-full hover:bg-white/10 hover:border-white/30 transition-all duration-300 hero-secondary-cta backdrop-blur-sm"
        >
          <span>View My Work</span>
          <svg class="w-5 h-5 transition-transform group-hover:translate-y-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>
          </svg>
        </a>

        <a
          href="#experience"
          class="group text-sm md:text-base py-4 px-8 md:py-5 md:px-10 text-neutral/80 hover:text-white inline-flex items-center gap-2 font-medium transition-all duration-300 hero-tertiary-cta"
        >
          <span>View Experience</span>
          <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </a>
      </div>
    </div>
  </div>

  <!-- Scroll indicator -->
  <div class="absolute bottom-10 left-1/2 -translate-x-1/2 scroll-indicator">
    <div class="w-6 h-10 border-2 border-neutral/30 rounded-full flex justify-center">
      <div class="w-1 h-2 bg-primary rounded-full mt-2 animate-bounce"></div>
    </div>
  </div>
</section>

<script>
  async function initHeroAnimation() {
    try {
      const gsap = (await import('gsap')).default;

      // Add class to indicate animations are ready
      document.documentElement.classList.add('animations-ready');

      const tl = gsap.timeline({ defaults: { ease: "power3.out" }});

      // Animate availability badge
      const availability = document.querySelector('.hero-availability');
      if (availability) {
        gsap.set(availability, { opacity: 1 });
        tl.from(availability, {
          y: -20,
          opacity: 0,
          duration: 0.6,
          ease: "back.out(1.7)"
        });
      }

      // Animate tagline
      const tagline = document.querySelector(".hero-tagline");
      if (tagline) {
        gsap.set(tagline, { opacity: 1 });
        tl.from(tagline, {
          y: 20,
          opacity: 0,
          duration: 0.6,
        }, "-=0.3");
      }

      // Animate name words with character stagger
      const nameWords = document.querySelectorAll('.hero-name-word');
      nameWords.forEach((word, wordIndex) => {
        const chars = word.querySelectorAll('.hero-name-char');
        if (chars.length > 0) {
          gsap.set(chars, { opacity: 1 });
          tl.from(chars, {
            y: 100,
            opacity: 0,
            rotationX: -90,
            duration: 0.8,
            stagger: 0.02,
            ease: "back.out(1.7)"
          }, wordIndex === 0 ? "-=0.2" : "-=0.6");
        }
      });

      // Animate specialty
      const specialty = document.querySelector(".hero-specialty");
      if (specialty) {
        gsap.set(specialty, { opacity: 1 });
        tl.from(specialty, {
          y: 30,
          opacity: 0,
          duration: 0.8,
        }, "-=0.5");
      }

      // Summary with reveal effect
      const summary = document.querySelector(".hero-summary");
      if (summary) {
        gsap.set(summary, { opacity: 1 });
        tl.from(summary, {
          y: 20,
          opacity: 0,
          duration: 0.8,
        }, "-=0.4");
      }

      // Animate stats
      const statItems = document.querySelectorAll('.hero-stat-item');
      if (statItems.length > 0) {
        statItems.forEach((item) => {
          gsap.set(item, { opacity: 1 });
        });
        tl.from(statItems, {
          y: 30,
          opacity: 0,
          duration: 0.6,
          stagger: 0.1,
          ease: "back.out(1.2)"
        }, "-=0.4");
      }

      // Buttons with pop effect
      const ctaBtn = document.querySelector(".hero-cta");
      if (ctaBtn) {
        gsap.set(ctaBtn, { opacity: 1, scale: 1 });
        tl.from(ctaBtn, {
          scale: 0,
          opacity: 0,
          duration: 0.6,
          ease: "back.out(2)"
        }, "-=0.3");
      }

      const secondaryCta = document.querySelector(".hero-secondary-cta");
      if (secondaryCta) {
        gsap.set(secondaryCta, { opacity: 1, scale: 1 });
        tl.from(secondaryCta, {
          scale: 0,
          opacity: 0,
          duration: 0.6,
          ease: "back.out(2)"
        }, "-=0.5");
      }

      const tertiaryCta = document.querySelector(".hero-tertiary-cta");
      if (tertiaryCta) {
        gsap.set(tertiaryCta, { opacity: 1 });
        tl.from(tertiaryCta, {
          x: -20,
          opacity: 0,
          duration: 0.6,
        }, "-=0.5");
      }

      // Scroll indicator
      const scrollIndicator = document.querySelector(".scroll-indicator");
      if (scrollIndicator) {
        gsap.set(scrollIndicator, { opacity: 1 });
        tl.from(scrollIndicator, {
          y: -20,
          opacity: 0,
          duration: 0.6,
        }, "-=0.3");
      }

      // Parallax effect for background gradients
      gsap.to(".hero-bg-gradient", {
        y: -50,
        x: 50,
        rotation: 90,
        duration: 20,
        repeat: -1,
        yoyo: true,
        ease: "sine.inOut"
      });

      gsap.to(".hero-bg-gradient-2", {
        y: 50,
        x: -50,
        rotation: -90,
        duration: 25,
        repeat: -1,
        yoyo: true,
        ease: "sine.inOut"
      });

      // Subtle mouse parallax effect (less intrusive)
      let mouseX = 0;
      let mouseY = 0;

      document.addEventListener('mousemove', (e) => {
        mouseX = (e.clientX / window.innerWidth - 0.5) * 2;
        mouseY = (e.clientY / window.innerHeight - 0.5) * 2;
      });

      // Smoother parallax using RAF
      function animateParallax() {
        gsap.to('.hero-name', {
          x: mouseX * 10,
          y: mouseY * 5,
          duration: 1,
          ease: "power2.out"
        });

        gsap.to('.hero-bg-gradient', {
          x: 50 + mouseX * 20,
          y: -50 + mouseY * 20,
          duration: 1.5,
          ease: "power2.out"
        });

        gsap.to('.hero-bg-gradient-2', {
          x: -50 + mouseX * -15,
          y: 50 + mouseY * -15,
          duration: 1.5,
          ease: "power2.out"
        });

        requestAnimationFrame(animateParallax);
      }
      animateParallax();

      // Magnetic effect on primary button
      const buttons = document.querySelectorAll('.hero-cta, .hero-secondary-cta');
      buttons.forEach(button => {
        button.addEventListener('mouseenter', function() {
          gsap.to(this, {
            scale: 1.05,
            duration: 0.3,
            ease: "back.out(1.7)"
          });
        });

        button.addEventListener('mouseleave', function() {
          gsap.to(this, {
            scale: 1,
            x: 0,
            y: 0,
            duration: 0.3,
            ease: "power2.out"
          });
        });

        button.addEventListener('mousemove', function(e: MouseEvent) {
          const rect = this.getBoundingClientRect();
          const x = e.clientX - rect.left - rect.width / 2;
          const y = e.clientY - rect.top - rect.height / 2;

          gsap.to(this, {
            x: x * 0.3,
            y: y * 0.3,
            duration: 0.3,
            ease: "power2.out"
          });
        });
      });
    } catch (error) {
      console.error('Hero animation failed:', error);
      // Ensure content is visible even if animation fails
      document.documentElement.classList.add('animations-failed');
    }
  }

  // Initialize immediately without waiting for DOMContentLoaded if DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initHeroAnimation);
  } else {
    initHeroAnimation();
  }
</script>

<style>
  .hero-name-char {
    display: inline-block;
    transform-origin: center bottom;
  }

  .hero-name-word {
    white-space: nowrap;
  }

  .scroll-indicator {
    animation: fadeInOut 2s ease-in-out infinite;
  }

  @keyframes fadeInOut {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 1; }
  }

  /* Ensure content is visible by default, animations will override */
  .hero-availability,
  .hero-tagline,
  .hero-name-char,
  .hero-specialty,
  .hero-summary,
  .hero-stat-item,
  .hero-cta,
  .hero-secondary-cta,
  .hero-tertiary-cta,
  .scroll-indicator {
    opacity: 0;
  }

  /* Show content if animations are ready or failed */
  .animations-ready .hero-availability,
  .animations-ready .hero-tagline,
  .animations-ready .hero-name-char,
  .animations-ready .hero-specialty,
  .animations-ready .hero-summary,
  .animations-ready .hero-stat-item,
  .animations-ready .hero-cta,
  .animations-ready .hero-secondary-cta,
  .animations-ready .hero-tertiary-cta,
  .animations-ready .scroll-indicator,
  .animations-failed .hero-availability,
  .animations-failed .hero-tagline,
  .animations-failed .hero-name-char,
  .animations-failed .hero-specialty,
  .animations-failed .hero-summary,
  .animations-failed .hero-stat-item,
  .animations-failed .hero-cta,
  .animations-failed .hero-secondary-cta,
  .animations-failed .hero-tertiary-cta,
  .animations-failed .scroll-indicator {
    opacity: 1 !important;
  }
</style>
