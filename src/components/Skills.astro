---
import Section from "./Section.astro";
import { SITE_CONTENT } from "@config";

const { row1, row2 } = SITE_CONTENT.skills;
---

<Section text="Experience Skills" href="skills">
  <div class="skills-container overflow-hidden py-10 relative">
    <!-- Glow effect -->
    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-primary/5 to-transparent blur-2xl pointer-events-none"></div>

    <div class="skills-row-1 whitespace-nowrap mb-8 relative">
      <div class="inline-block">
        {row1.map((skill, index) => (
          <span
            class="skill-item text-4xl md:text-5xl font-bold text-white/80 mx-4 inline-block px-6 py-3 rounded-2xl border border-white/10 bg-gradient-to-br from-white/5 to-transparent backdrop-blur-sm hover:border-primary/50 hover:text-primary hover:shadow-lg hover:shadow-primary/20 transition-all duration-300 cursor-pointer"
            data-skill={skill}
            data-index={index}
          >
            {skill}
          </span>
        ))}
      </div>
    </div>

    <div class="skills-row-2 whitespace-nowrap relative">
      <div class="inline-block">
        {row2.map((skill, index) => (
          <span
            class="skill-item text-4xl md:text-5xl font-bold text-white/80 mx-4 inline-block px-6 py-3 rounded-2xl border border-white/10 bg-gradient-to-br from-white/5 to-transparent backdrop-blur-sm hover:border-primary/50 hover:text-primary hover:shadow-lg hover:shadow-primary/20 transition-all duration-300 cursor-pointer"
            data-skill={skill}
            data-index={index}
          >
            {skill}
          </span>
        ))}
      </div>
    </div>
  </div>
</Section>

<script>
  async function initSkillsAnimation() {
    const gsap = (await import('gsap')).default;
    const ScrollTrigger = (await import('gsap/ScrollTrigger')).default;

    gsap.registerPlugin(ScrollTrigger);

    // Clone skills for infinite scroll effect
    const row1 = document.querySelector('.skills-row-1 div');
    const row2 = document.querySelector('.skills-row-2 div');

    if (row1 && row2) {
      row1.innerHTML += row1.innerHTML;
      row2.innerHTML += row2.innerHTML;

      // First row animation (right to left)
      gsap.to('.skills-row-1 div', {
        x: '-50%',
        duration: 30,
        ease: 'none',
        repeat: -1
      });

      // Second row animation (left to right)
      gsap.fromTo('.skills-row-2 div',
        { x: '-50%' },
        {
          x: '0%',
          duration: 30,
          ease: 'none',
          repeat: -1
        }
      );

      // Pause on hover
      const rows = ['.skills-row-1', '.skills-row-2'];
      rows.forEach(selector => {
        const row = document.querySelector(selector);
        row?.addEventListener('mouseenter', () => {
          gsap.to(`${selector} div`, { timeScale: 0.2, duration: 0.5 });
        });
        row?.addEventListener('mouseleave', () => {
          gsap.to(`${selector} div`, { timeScale: 1, duration: 0.5 });
        });
      });
    }

    // 3D hover effect on individual skills
    const skillItems = document.querySelectorAll('.skill-item');
    skillItems.forEach(item => {
      item.addEventListener('mouseenter', function(e) {
        gsap.to(this, {
          scale: 1.1,
          rotationY: 5,
          z: 50,
          duration: 0.3,
          ease: "back.out(1.7)"
        });
      });

      item.addEventListener('mouseleave', function(e) {
        gsap.to(this, {
          scale: 1,
          rotationY: 0,
          z: 0,
          duration: 0.3,
          ease: "power2.out"
        });
      });

      // 3D tilt effect based on mouse position
      item.addEventListener('mousemove', function(e) {
        const rect = this.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        const centerX = rect.width / 2;
        const centerY = rect.height / 2;

        const rotateX = ((y - centerY) / centerY) * -10;
        const rotateY = ((x - centerX) / centerX) * 10;

        gsap.to(this, {
          rotationX: rotateX,
          rotationY: rotateY,
          duration: 0.3,
          ease: "power2.out",
          transformPerspective: 1000
        });
      });
    });

    // Entrance animation
    gsap.from('.skill-item', {
      scrollTrigger: {
        trigger: '.skills-container',
        start: "top 80%",
        toggleActions: "play none none reverse"
      },
      scale: 0,
      opacity: 0,
      duration: 0.6,
      stagger: 0.05,
      ease: "back.out(1.7)"
    });
  }

  document.addEventListener('DOMContentLoaded', initSkillsAnimation);
</script>

<style>
  .skills-container {
    position: relative;
    width: 100%;
    perspective: 1000px;
  }

  .skills-row-1, .skills-row-2 {
    position: relative;
    width: 100%;
    overflow: hidden;
  }

  .skill-item {
    transform-style: preserve-3d;
    will-change: transform;
  }
</style>